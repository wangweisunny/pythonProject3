rule Webshell_Detection
{
    meta:
        description = "Detects common Webshell patterns"
        author = "Your Name"
        date = "2024-11-12"

    strings:
        $eval = /eval\s*\(\s*base64_decode\s*\(/ nocase
        $system = /system\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $exec = /exec\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $shell_exec = /shell_exec\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $passthru = /passthru\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $preg_replace = /preg_replace\s*\(\s*['"][/e]['"]\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $assert = /assert\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $create_function = /create_function\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $call_user_func = /call_user_func\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $call_user_func_array = /call_user_func_array\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $php_input = /php\s*:\s*\/\/\s*input\s*[^>]+/ nocase
        $gzinflate = /gzinflate\s*\(\s*base64_decode\s*\(/ nocase
        $strrev = /strrev\s*\(\s*[^)]+\s*\)/ nocase
        $base64_decode = /base64_decode\s*\(\s*[^)]+\s*\)/ nocase
        $file_put_contents = /file_put_contents\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $file_get_contents = /file_get_contents\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fopen = /fopen\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*['"]w['"]\s*\)/ nocase
        $fwrite = /fwrite\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fclose = /fclose\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $move_uploaded_file = /move_uploaded_file\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $unlink = /unlink\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $chmod = /chmod\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*\d+\s*\)/ nocase
        $chown = /chown\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $chgrp = /chgrp\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $touch = /touch\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $mkdir = /mkdir\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*\d+\s*\)/ nocase
        $rmdir = /rmdir\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $rename = /rename\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $copy = /copy\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $symlink = /symlink\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $link = /link\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $readlink = /readlink\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $realpath = /realpath\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $file_exists = /file_exists\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $is_file = /is_file\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $is_dir = /is_dir\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $is_readable = /is_readable\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $is_writable = /is_writable\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $is_executable = /is_executable\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $filesize = /filesize\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $filetype = /filetype\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fileperms = /fileperms\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fileatime = /fileatime\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $filemtime = /filemtime\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $filectime = /filectime\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fileinode = /fileinode\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $filegroup = /filegroup\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fileowner = /fileowner\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $file_get_contents = /file_get_contents\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $file_put_contents = /file_put_contents\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $file = /file\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $readfile = /readfile\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fopen = /fopen\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*['"]r['"]\s*\)/ nocase
        $fread = /fread\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*\d+\s*\)/ nocase
        $fwrite = /fwrite\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fclose = /fclose\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fgetc = /fgetc\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fgets = /fgets\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fgetss = /fgetss\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fgetcsv = /fgetcsv\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fputs = /fputs\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fscanf = /fscanf\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*['"][^'"]+['"]\s*\)/ nocase
        $fseek = /fseek\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*\d+\s*\)/ nocase
        $ftell = /ftell\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $feof = /feof\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $flock = /flock\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*\d+\s*\)/ nocase
        $ftruncate = /ftruncate\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*\d+\s*\)/ nocase
        $fflush = /fflush\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $fstat = /fstat\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_get_contents = /stream_get_contents\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_create = /stream_context_create\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_params = /stream_context_set_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_default = /stream_context_get_default\s*\(\s*\)/ nocase
        $stream_context_set_default = /stream_context_set_default\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_set_option = /stream_context_set_option\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*,\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_params = /stream_context_get_params\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get_options = /stream_context_get_options\s*\(\s*[$_A-Z]+\['[A-Z_]+\']\s*\)/ nocase
        $stream_context_get